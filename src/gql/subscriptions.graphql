subscription liveProtocol {
    protocol(id: "0x42069") {
        id
        totalNuggs
        lastEpoch {
            ...epochswapdata
        }
        nextEpoch {
            _upcomingActiveItemSwaps
            ...epochswapdata
        }
        featureTotals
        nuggftStakedEth
        nuggftStakedShares
        activeNuggs(orderBy: idnum) {
            id
            idnum
            activeSwap {
                ...swapdata
                # id
                # eth
                # endingEpoch
            }
        }
        featureTotals
        activeNuggItems {
            id
            activeSwap {
                ...itemswapdata

                # id
                # sellingNuggItem {
                #     id
                #     item {
                #         id
                #     }
                # }
                # eth
                # endingEpoch
            }
        }
        activeItems {
            id
            activeSwap {
                ...itemswapdata
                # id
                # sellingItem {
                #     id
                # }
                # eth
                # endingEpoch
            }
            upcomingActiveSwap {
                ...itemswapdata

                # id
                # sellingItem {
                #     id
                # }
                # eth
                # endingEpoch
            }
        }
    }
}

subscription liveDotnugg($tokenId: ID!) {
    nugg(id: $tokenId) {
        id
        dotnuggRawCache
    }
}

subscription liveUser($address: ID!) {
    user(id: $address) {
        offers(where: { claimed: false }) {
            id
            eth
            swap {
                id
                nugg {
                    id
                }
                leader {
                    id
                }
                endingEpoch
            }
        }
        loans {
            id
            endingEpoch
            eth
            nugg {
                id
            }
            epoch {
                id
            }
        }
        nuggs(first: 500) {
            id
            activeLoan {
                id
            }
            activeSwap {
                id
            }
            ...nuggitems
            pendingClaim
            lastTransfer
            offers(where: { claimed: false }) {
                id
                eth
                swap {
                    id
                    sellingItem {
                        id
                    }
                    sellingNuggItem {
                        id
                        nugg {
                            id
                        }
                    }
                    leader {
                        id
                    }
                    endingEpoch
                }
            }
        }
    }
}

fragment epochswapdata on Epoch {
    swaps {
        ...swapdata
        nugg {
            id
        }
    }
    itemSwaps {
        ...itemswapdata
        sellingItem {
            id
        }
    }
}

fragment swapdata on Swap {
    id
    endingEpoch
    epoch {
        id
        startblock
        endblock
        status
        starttime
    }
    num
    top
    topUsd
    bottom
    owner {
        id
    }
    canceledEpoch
    leader {
        id
    }
    offers(first: 5, orderBy: eth, orderDirection: desc) {
        id
        user {
            id
        }
        eth
        txhash
    }
}

fragment itemswapdata on ItemSwap {
    id
    endingEpoch
    epoch {
        id
        startblock
        endblock
        status
        starttime
    }
    canceledEpoch

    num
    top
    topUsd
    bottom
    owner {
        id
    }
    leader {
        id
    }
    sellingItem {
        id
    }
    offers(first: 5, orderBy: eth, orderDirection: desc) {
        id
        nugg {
            id
        }
        eth
        txhash
    }
}

fragment nuggitems on Nugg {
    items {
        id
        count
        displayed
        activeSwap {
            id
        }
        item {
            id
            feature
            position
        }
    }
}

fragment liveNugg on Nugg {
    id
    user {
        id
    }
    ...nuggitems

    pendingClaim
    lastTransfer
    activeLoan {
        id
    }
    activeSwap {
        ...swapdata
    }
    swaps(orderDirection: desc, orderBy: id) {
        ...swapdata
    }
}

fragment liveItem on Item {
    id
    count
    rarityX16
    activeSwap {
        ...itemswapdata
    }
    upcomingActiveSwap {
        ...itemswapdata
    }
    swaps {
        ...itemswapdata
    }
}

subscription watchLiveItem($tokenId: ID!) {
    item(id: $tokenId) {
        ...liveItem
    }
}

subscription watchLiveNugg($tokenId: ID!) {
    nugg(id: $tokenId) {
        ...liveNugg
        # activeSwap {
        #     id
        #     offers(orderBy: eth, orderDirection: desc) {
        #         user {
        #             id
        #         }
        #         eth
        #         txhash
        #     }
        # }
    }
}

subscription liveItemOffers($tokenId: String!) {
    itemOffers(where: { swap_starts_with: $tokenId }, orderBy: eth, orderDirection: desc) {
        id
        nugg {
            id
        }
        eth
        txhash
    }
}

subscription liveOffers($tokenId: String!) {
    offers(where: { swap_starts_with: $tokenId }, orderBy: eth, orderDirection: desc) {
        id
        user {
            id
        }
        eth
        txhash
    }
}

fragment liveItemSwap on ItemSwap {
    id
    sellingNuggItem {
        id
        nugg {
            id
        }
    }
    offers(orderBy: eth, orderDirection: desc) {
        id
        nugg {
            id
        }
        eth
        txhash
    }
}

subscription betterLiveItemOffers($tokenId: ID!) {
    item(id: $tokenId) {
        id
        activeSwap {
            ...liveItemSwap
        }
        upcomingActiveSwap {
            ...liveItemSwap
        }
    }
}

subscription betterLiveOffers($tokenId: ID!) {
    nugg(id: $tokenId) {
        id
        activeSwap {
            id
            offers(orderBy: eth, orderDirection: desc) {
                id
                user {
                    id
                }
                eth
                txhash
            }
        }
    }
}
