subscription liveProtocol {
    protocol(id: "0x42069") {
        id
        # epoch {
        #     id
        #     status
        #     startblock
        #     endblock
        #     starttime
        # }
        lastEpoch {
            ...epochswapdata
        }
        nextEpoch {
            # id
            # status
            # startblock
            # endblock
            # starttime
            _upcomingActiveItemSwaps
            ...epochswapdata
        }
        nuggftStakedEth
        nuggftStakedShares
        activeNuggs(orderBy: idnum) {
            id
            idnum
            activeSwap {
                id
                eth
                endingEpoch
            }
        }
        activeNuggItems {
            id
            activeSwap {
                id
                sellingNuggItem {
                    id
                    item {
                        id
                    }
                }
                eth
                endingEpoch
            }
        }
        activeItems {
            id
            activeSwap {
                id
                sellingItem {
                    id
                }
                eth
                endingEpoch
            }
            upcomingActiveSwap {
                id
                sellingItem {
                    id
                }
                eth
                endingEpoch
            }
        }
    }
}

subscription liveDotnugg($tokenId: ID!) {
    nugg(id: $tokenId) {
        id
        dotnuggRawCache
    }
}

subscription liveUser($address: ID!) {
    user(id: $address) {
        offers(where: { claimed: false }) {
            id
            eth
            swap {
                id
                nugg {
                    id
                }
                leader {
                    id
                }
                endingEpoch
            }
        }
        loans {
            id
            endingEpoch
            eth
            nugg {
                id
            }
            epoch {
                id
            }
        }
        nuggs(first: 500) {
            id
            activeLoan {
                id
            }
            activeSwap {
                id
            }
            pendingClaim
            lastTransfer
            offers(where: { claimed: false }) {
                id
                eth
                swap {
                    id
                    sellingItem {
                        id
                    }
                    sellingNuggItem {
                        id
                        nugg {
                            id
                        }
                    }
                    leader {
                        id
                    }
                    endingEpoch
                }
            }
        }
    }
}

fragment epochswapdata on Epoch {
    swaps {
        ...swapdata
        nugg {
            id
        }
    }
    itemSwaps {
        ...itemswapdata
        sellingItem {
            id
        }
    }
}

fragment swapdata on Swap {
    id
    endingEpoch
    epoch {
        id
        startblock
        endblock
        status
        starttime
    }
    num
    eth
    ethUsd
    bottom
    owner {
        id
    }
    leader {
        id
    }
}

fragment itemswapdata on ItemSwap {
    id
    endingEpoch
    epoch {
        id
        startblock
        endblock
        status
        starttime
    }
    num
    eth
    ethUsd
    bottom
    owner {
        id
    }
    leader {
        id
    }
    sellingNuggItem {
        id
        nugg {
            id
        }
    }
}

fragment liveNugg on Nugg {
    id
    user {
        id
    }
    items {
        id
        activeSwap {
            id
        }
        item {
            id
            feature
            position
        }
    }

    pendingClaim
    lastTransfer
    activeLoan {
        id
    }
    activeSwap {
        ...swapdata
    }
    swaps {
        ...swapdata
    }
}

fragment liveItem on Item {
    id
    count
    activeSwap {
        ...itemswapdata
    }
    upcomingActiveSwap {
        ...itemswapdata
    }
    swaps {
        ...itemswapdata
    }
}

subscription watchLiveItem($tokenId: ID!) {
    item(id: $tokenId) {
        ...liveItem
    }
}

subscription watchLiveNugg($tokenId: ID!) {
    nugg(id: $tokenId) {
        ...liveNugg
    }
}

subscription liveItemOffers($tokenId: String!) {
    itemOffers(where: { swap_starts_with: $tokenId }, orderBy: eth, orderDirection: desc) {
        id
        nugg {
            id
        }
        eth
        txhash
    }
}

subscription liveOffers($tokenId: String!) {
    offers(where: { swap_starts_with: $tokenId }, orderBy: eth, orderDirection: desc) {
        id
        user {
            id
        }
        eth
        txhash
    }
}

fragment liveItemSwap on ItemSwap {
    id
    sellingNuggItem {
        id
        nugg {
            id
        }
    }
    # bottom
    # owner {
    #     id
    # }
    offers(orderBy: eth, orderDirection: desc) {
        id
        nugg {
            id
        }
        eth
        txhash
    }
}

subscription betterLiveItemOffers($tokenId: ID!) {
    item(id: $tokenId) {
        activeSwap {
            ...liveItemSwap
        }
        upcomingActiveSwap {
            ...liveItemSwap
        }
    }
}

subscription betterLiveOffers($tokenId: ID!) {
    nugg(id: $tokenId) {
        activeSwap {
            id
            # owner {
            #     id
            # }
            # bottom
            offers(orderBy: eth, orderDirection: desc) {
                user {
                    id
                }
                eth
                txhash
            }
        }
    }
}
